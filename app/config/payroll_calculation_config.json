{
  "variable_labels": {
    "employment_salary": "聘用薪资",
    "base_ratio": "基础薪资比例",
    "perf_ratio": "绩效薪资比例",
    "employee_discount": "员工类别折算系数",
    "assessment_coefficient": "绩效系数",
    "gross_2": "基础薪资部分",
    "gross_3": "绩效薪资部分",
    "gross_4": "折算后基础薪资",
    "gross_5": "折算后绩效薪资",
    "gross_6": "绩效系数",
    "gross_7": "实际绩效薪资",
    "gross_8": "事假扣减",
    "gross_9": "病假扣减",
    "gross_10": "考勤扣减合计",
    "gross_11": "奖惩金额",
    "base_amount": "应发金额",
    "MONTHLY_WORK_DAYS": "月计薪天数",
    "personal_leave_days": "事假天数",
    "sick_leave_days": "病假天数",
    "reward_punishment_amount": "奖惩金额",
    "social_security_base": "社保基数",
    "housing_fund_base": "公积金基数",
    "pension_rate": "养老个人比例",
    "unemployment_rate": "失业个人比例",
    "medical_rate": "医疗个人比例",
    "housing_rate": "公积金个人比例",
    "serious_illness_amount": "大病个人缴费金额",
    "social_1": "社保三险个人合计",
    "social_2": "大病个人缴费金额",
    "social_3": "社保个人扣除",
    "social_4": "公积金个人扣除",
    "social_5": "社保公积金扣除合计",
    "tax_deduction_children": "子女教育",
    "tax_deduction_continuing": "继续教育",
    "tax_deduction_housing_loan": "住房贷款利息",
    "tax_deduction_housing_rent": "住房租金",
    "tax_deduction_elderly": "赡养老人",
    "tax_deduction_infant": "3岁以下婴幼儿照护",
    "tax_1": "专项累计扣除",
    "tax_2": "专项附加扣除合计",
    "tax_3": "税前扣除项目合计",
    "tax_4": "上月累计专项扣除合计",
    "tax_5": "上月薪资的累计专项合计(不含附加)",
    "tax_6": "累计扣除项目合计",
    "tax_7": "上月累计收入",
    "tax_8": "累计收入",
    "tax_9": "减除费用",
    "tax_10": "税前工资",
    "tax_11": "累计计税部分",
    "tax_12": "累计个税",
    "tax_13": "上月累计个税",
    "tax_14": "本月个税"
  },
  "variable_sources": {
    "employment_salary": { "source": "transform", "from": "employment", "transform": "salary_to_monthly" },
    "base_ratio": { "source": "lookup", "from": "employment", "field": "position_category", "lookup": "position_salary_ratio", "output": "base_ratio", "default": 0.7 },
    "perf_ratio": { "source": "lookup", "from": "employment", "field": "position_category", "lookup": "position_salary_ratio", "output": "performance_ratio", "default": 0.3 },
    "employee_discount": { "source": "lookup", "from": "employment", "field": "employee_type", "lookup": "employee_type_discount", "default": 1.0 },
    "assessment_coefficient": { "source": "lookup", "from": "assessment", "field": "grade", "lookup": "assessment_grade_coefficient", "default": 1.0 },
    "personal_leave_days": { "source": "field", "from": "attendance_record", "field": "personal_leave_days", "default": 0 },
    "sick_leave_days": { "source": "field", "from": "attendance_record", "field": "sick_leave_days", "default": 0 },
    "reward_punishment_amount": { "source": "field", "from": "attendance_record", "field": "reward_punishment_amount", "default": 0 },
    "MONTHLY_WORK_DAYS": { "source": "constant", "value": 21.75 },
    "social_security_base": { "source": "field", "from": "social_base", "field": "base_amount", "default": 0 },
    "housing_fund_base": { "source": "field", "from": "housing_base", "field": "base_amount", "default": 0 },
    "pension_rate": { "source": "config", "config": "social_security_config", "keyed_by": "period", "field": "pension_employee_rate", "default": 0.105 },
    "unemployment_rate": { "source": "config", "config": "social_security_config", "keyed_by": "period", "field": "unemployment_employee_rate", "default": 0 },
    "medical_rate": { "source": "config", "config": "social_security_config", "keyed_by": "period", "field": "medical_employee_rate", "default": 0 },
    "housing_rate": { "source": "config", "config": "social_security_config", "keyed_by": "period", "field": "housing_fund_employee_rate", "default": 0.12 },
    "serious_illness_amount": { "source": "config", "config": "social_security_config", "keyed_by": "period", "field": "serious_illness_employee_amount", "default": 0 },
    "tax_deduction_children": { "source": "field", "from": "tax_deduction", "field": "children_education_amount", "default": 0 },
    "tax_deduction_continuing": { "source": "field", "from": "tax_deduction", "field": "continuing_education_amount", "default": 0 },
    "tax_deduction_housing_loan": { "source": "field", "from": "tax_deduction", "field": "housing_loan_interest_amount", "default": 0 },
    "tax_deduction_housing_rent": { "source": "field", "from": "tax_deduction", "field": "housing_rent_amount", "default": 0 },
    "tax_deduction_elderly": { "source": "field", "from": "tax_deduction", "field": "elderly_support_amount", "default": 0 },
    "tax_deduction_infant": { "source": "field", "from": "tax_deduction", "field": "infant_childcare_amount", "default": 0 },
    "tax_4": { "source": "field", "from": "prev_payroll", "field": "tax_6", "default": 0 },
    "tax_7": { "source": "field", "from": "prev_payroll", "field": "tax_8", "default": 0 },
    "tax_13": { "source": "field", "from": "prev_payroll", "field": "tax_12", "default": 0 }
  },
  "sections": {
    "gross": {
      "label": "应发薪资计算",
      "step_order": [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12],
      "steps": [
        {"step": 1, "field_name": "聘用薪资", "source": "variable", "variable_key": "employment_salary", "default_formula": "", "desc": "当月聘用记录中的薪资，用于岗位划分与考勤公式"},
        {"step": 2, "field_name": "基础薪资部分", "source": "formula", "output_key": "gross_2", "default_formula": "employment_salary * base_ratio", "desc": "第1步：按岗位类别划分的基础薪资部分"},
        {"step": 3, "field_name": "绩效薪资部分", "source": "formula", "output_key": "gross_3", "default_formula": "employment_salary * perf_ratio", "desc": "第1步：按岗位类别划分的绩效薪资部分"},
        {"step": 4, "field_name": "折算后基础薪资", "source": "formula", "output_key": "gross_4", "default_formula": "gross_2 * employee_discount", "desc": "第2步：按员工类别折算后的基础薪资"},
        {"step": 5, "field_name": "折算后绩效薪资", "source": "formula", "output_key": "gross_5", "default_formula": "gross_3 * employee_discount", "desc": "第2步：按员工类别折算后的绩效薪资"},
        {"step": 6, "field_name": "绩效系数", "source": "formula", "output_key": "gross_6", "default_formula": "assessment_coefficient", "desc": "第3步：考核等级对应的绩效系数"},
        {"step": 7, "field_name": "实际绩效薪资", "source": "formula", "output_key": "gross_7", "default_formula": "gross_5 * gross_6", "desc": "第3步：折算后绩效薪资 × 绩效系数"},
        {"step": 8, "field_name": "事假扣减", "source": "formula", "output_key": "gross_8", "default_formula": "employment_salary / MONTHLY_WORK_DAYS * personal_leave_days", "desc": "第4步：聘用薪资/21.75×事假天数"},
        {"step": 9, "field_name": "病假扣减", "source": "formula", "output_key": "gross_9", "default_formula": "employment_salary / MONTHLY_WORK_DAYS * 0.3 * sick_leave_days", "desc": "第4步：聘用薪资/21.75×0.3×病假天数"},
        {"step": 10, "field_name": "考勤扣减合计", "source": "formula", "output_key": "gross_10", "default_formula": "gross_8 + gross_9", "desc": "第4步：事假扣减 + 病假扣减"},
        {"step": 11, "field_name": "奖惩金额", "source": "formula", "output_key": "gross_11", "default_formula": "reward_punishment_amount", "desc": "第5步：考勤中的奖惩金额"},
        {"step": 12, "field_name": "应发金额", "source": "formula", "output_key": "base_amount", "default_formula": "max(0, gross_4 + gross_7 - gross_10 + gross_11)", "desc": "第6步：折算后基础 + 实际绩效 − 考勤扣减 + 奖惩"}
      ]
    },
    "social": {
      "label": "社保公积金扣除计算",
      "step_order": [1, 2, 3, 4, 5],
      "steps": [
        {"step": 1, "field_name": "社保三险个人合计", "source": "formula", "output_key": "social_1", "default_formula": "social_security_base * (pension_rate + unemployment_rate + medical_rate)", "desc": "第1步：社保基数×(养老+失业+医疗个人比例)"},
        {"step": 2, "field_name": "大病个人缴费金额", "source": "formula", "output_key": "social_2", "default_formula": "serious_illness_amount", "desc": "第2步：从社保公积金配置中取出的大病个人缴费金额"},
        {"step": 3, "field_name": "社保个人扣除", "source": "formula", "output_key": "social_3", "default_formula": "social_1 + social_2", "desc": "第3步：三险个人 + 大病个人"},
        {"step": 4, "field_name": "公积金个人扣除", "source": "formula", "output_key": "social_4", "default_formula": "housing_fund_base * housing_rate", "desc": "第4步：公积金基数×公积金个人缴费比例"},
        {"step": 5, "field_name": "社保公积金扣除合计", "source": "formula", "output_key": "social_5", "default_formula": "social_3 + social_4", "desc": "第5步：社保个人扣除 + 公积金个人扣除"}
      ]
    },
    "tax": {
      "label": "个税计算",
      "step_order": [1, 2, 3, 4, 6, 5, 7, 8, 9, 10, 11, 12, 13, 14],
      "steps": [
        {"step": 1, "field_name": "专项累计扣除", "source": "formula", "output_key": "tax_1", "default_formula": "social_3 + social_4", "desc": "社保个人扣除+公积金个人扣除（专项累计扣除）"},
        {"step": 2, "field_name": "专项附加扣除合计", "source": "formula", "output_key": "tax_2", "default_formula": "tax_deduction_children + tax_deduction_continuing + tax_deduction_housing_loan + tax_deduction_housing_rent + tax_deduction_elderly + tax_deduction_infant", "desc": "专项附加扣除合计（子女教育+继续教育+住房贷款利息+住房租金+赡养老人+3岁以下婴幼儿照护）"},
        {"step": 3, "field_name": "税前扣除项目合计", "source": "formula", "output_key": "tax_3", "default_formula": "tax_1 + tax_2", "desc": "税前扣除项目合计（专项累计扣除+专项附加扣除合计）"},
        {"step": 4, "field_name": "上月累计专项扣除合计", "source": "variable", "variable_key": "tax_4", "output_key": "tax_4", "default_formula": "", "desc": "上月累计专项扣除合计（上月带入）"},
        {"step": 5, "field_name": "上月薪资的累计专项合计(不含附加)", "source": "formula", "output_key": "tax_5", "default_formula": "tax_6 - tax_2", "desc": "上月薪资的累计专项合计(不含附加)"},
        {"step": 6, "field_name": "累计扣除项目合计", "source": "formula", "output_key": "tax_6", "default_formula": "tax_3 + tax_4", "desc": "累计扣除项目合计（税前扣除项目合计+上月累计专项扣除合计）"},
        {"step": 7, "field_name": "上月累计收入", "source": "variable", "variable_key": "tax_7", "output_key": "tax_7", "default_formula": "", "desc": "上月累计收入（上月带入）"},
        {"step": 8, "field_name": "累计收入", "source": "formula", "output_key": "tax_8", "default_formula": "tax_7 + base_amount", "desc": "累计收入（上月累计+本月应发）"},
        {"step": 9, "field_name": "减除费用", "source": "formula", "output_key": "tax_9", "default_formula": "5000", "desc": "减除费用（5000）"},
        {"step": 10, "field_name": "税前工资", "source": "formula", "output_key": "tax_10", "default_formula": "base_amount - tax_1", "desc": "税前工资（应发-专项累计扣除）"},
        {"step": 11, "field_name": "累计计税部分", "source": "formula", "output_key": "tax_11", "default_formula": "max(0, tax_8 - tax_6 - tax_9)", "desc": "累计计税部分（累计收入-累计扣除-减除费用）"},
        {"step": 12, "field_name": "累计个税", "source": "formula", "output_key": "tax_12", "default_formula": "cumulative_tax(tax_11)", "desc": "累计个税（按税率表）"},
        {"step": 13, "field_name": "上月累计个税", "source": "variable", "variable_key": "tax_13", "output_key": "tax_13", "default_formula": "", "desc": "上月累计个税（上月带入）"},
        {"step": 14, "field_name": "本月个税", "source": "formula", "output_key": "tax_14", "default_formula": "max(0, tax_12 - tax_13)", "desc": "本月个税（累计个税-上月累计个税）"}
      ]
    }
  }
}
