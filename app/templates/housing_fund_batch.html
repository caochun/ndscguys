{% extends "layout.html" %}
{% block title %}公积金批量调整{% endblock %}

{% block extra_head %}
<style>
    .batch-card {
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(18,38,63,.08);
    }
    /* 公积金批量预览模态框样式，尽量贴近 Material Design 卡片风格 */
    .housing-batch-modal {
        max-height: 85vh;
        width: 80vw;
        border-radius: 12px;
    }
    .housing-batch-modal .modal-content {
        padding: 24px 24px 8px;
    }
    .housing-batch-modal .modal-footer {
        padding: 8px 24px;
    }
    #housingBatchPreviewTableContainer table thead {
        background: #f5f5f5;
    }
    #housingBatchPreviewTableContainer table thead th {
        font-size: 12px;
        color: #616161;
    }
</style>
{% endblock %}

{% block content %}
<div class="section">
    <h5>公积金批量调整</h5>
    <p class="grey-text text-darken-1">
        设置一次公积金调整规则，并为所有符合条件的在职员工生成新的公积金事件。
    </p>

    <div class="card batch-card">
        <div class="card-content">
            <span class="card-title" style="font-size:18px;">调整参数</span>
            <form id="housingBatchForm">
                <div class="row">
                    <div class="input-field col s12 m4">
                        <input id="batch_effective_date" name="effective_date" type="date">
                        <label for="batch_effective_date" class="active">生效日期</label>
                    </div>
                    <div class="input-field col s12 m4">
                        <input id="batch_min_base" name="min_base_amount" type="number" step="0.01" min="0">
                        <label for="batch_min_base">基数下限</label>
                    </div>
                    <div class="input-field col s12 m4">
                        <input id="batch_max_base" name="max_base_amount" type="number" step="0.01" min="0">
                        <label for="batch_max_base">基数上限</label>
                    </div>
                </div>
                <div class="row">
                    <div class="input-field col s12 m4">
                        <input id="batch_default_company_rate" name="default_company_rate" type="number" step="0.001" min="0" max="1">
                        <label for="batch_default_company_rate">默认公司比例</label>
                    </div>
                    <div class="input-field col s12 m4">
                        <input id="batch_default_personal_rate" name="default_personal_rate" type="number" step="0.001" min="0" max="1">
                        <label for="batch_default_personal_rate">默认个人比例</label>
                    </div>
                    <div class="input-field col s12 m4">
                        <input id="batch_target_company" name="target_company" type="text">
                        <label for="batch_target_company">仅限公司（可选）</label>
                    </div>
                </div>
                <div class="row">
                    <div class="input-field col s12 m4">
                        <input id="batch_target_department" name="target_department" type="text">
                        <label for="batch_target_department">仅限部门（可选）</label>
                    </div>
                    <div class="input-field col s12 m4">
                        <input id="batch_target_employee_type" name="target_employee_type" type="text">
                        <label for="batch_target_employee_type">仅限员工类别（可选）</label>
                    </div>
                    <div class="input-field col s12 m4">
                        <input id="batch_note" name="note" type="text">
                        <label for="batch_note">备注（可选）</label>
                    </div>
                </div>
            </form>
        </div>
        <div class="card-action right-align">
            <button id="previewHousingBatchBtn" class="btn waves-effect waves-light">
                <i class="material-icons left">visibility</i>预览批量调整
            </button>
        </div>
    </div>

    <div class="card batch-card" style="margin-top:24px;">
        <div class="card-content">
            <span class="card-title" style="font-size:18px;">最近批次</span>
            <div id="batchHistoryContainer" class="grey-text">加载中...</div>
        </div>
    </div>
</div>

<!-- 批量预览 / 详情模态框 -->
<div id="housingBatchPreviewModal" class="modal modal-fixed-footer housing-batch-modal">
    <div class="modal-content">
        <h5 id="housingBatchPreviewTitle">公积金批量调整预览</h5>
        <div id="housingBatchPreviewSummary" class="grey-text" style="margin-bottom: 12px;"></div>
        <div id="housingBatchPreviewTableContainer" style="max-height: 400px; overflow-y: auto;">
            <!-- 表格渲染在这里 -->
        </div>
    </div>
    <div class="modal-footer">
        <a href="#!" class="modal-close waves-effect waves-green btn-flat">取消</a>
        <button id="confirmHousingBatchBtn" class="waves-effect waves-light btn">确认</button>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="{{ url_for('static', filename='js/housing_fund_batch.js') }}"></script>
{% endblock %}


