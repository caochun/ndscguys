{% extends "layout.html" %}
{% block title %}项目管理{% endblock %}
{% block extra_head %}
<style>
    body {
        background: #f5f6fa;
    }
    .project-card {
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(18,38,63,.08);
        min-height: 200px;
    }
    .project-card .card-content {
        padding: 20px;
    }
    .project-card .card-title {
        font-size: 20px;
        font-weight: 500;
        margin-bottom: 12px;
    }
    .project-info-item {
        margin-bottom: 8px;
        font-size: 14px;
    }
    .project-info-label {
        color: #757575;
        display: inline-block;
        min-width: 100px;
    }
    .modal {
        border-radius: 12px;
    }
    .modal .modal-content {
        padding: 24px;
    }
    .history-block {
        background: #f8fafc;
        border-radius: 8px;
        padding: 12px;
        margin-bottom: 12px;
    }
    .person-tag {
        display: inline-block;
        padding: 4px 12px;
        margin: 4px;
        background: #e3f2fd;
        border-radius: 16px;
        font-size: 13px;
    }
</style>
{% endblock %}

{% block content %}
<div class="section">
    <div class="right-align" style="margin-bottom: 16px;">
        <a class="btn waves-effect waves-light" id="openCreateModal">
            <i class="material-icons left">add</i>新建项目
        </a>
    </div>
    <div class="row" id="projectCards">
        <div class="col s12 center-align grey-text text-darken-1" style="margin-top: 40px;">
            正在加载...
        </div>
    </div>
</div>

<!-- 创建项目模态框 -->
<div id="createProjectModal" class="modal modal-fixed-footer">
    <div class="modal-content">
        <h5>新建项目</h5>
        <form id="createProjectForm">
            <div class="row">
                <div class="input-field col s12">
                    <input id="contract_name" name="contract_name" type="text" required>
                    <label for="contract_name">合同名称 *</label>
                </div>
                <div class="input-field col s12 m6">
                    <input id="start_date" name="start_date" type="date">
                    <label for="start_date">开始日期</label>
                </div>
                <div class="input-field col s12 m6">
                    <input id="end_date" name="end_date" type="date">
                    <label for="end_date">结束日期</label>
                </div>
                <div class="input-field col s12">
                    <input id="client_company" name="client_company" type="text">
                    <label for="client_company">甲方单位</label>
                </div>
                <div class="input-field col s12 m6">
                    <input id="client_department" name="client_department" type="text">
                    <label for="client_department">甲方部门</label>
                </div>
                <div class="input-field col s12">
                    <input id="client_project_manager" name="client_project_manager" type="text">
                    <label for="client_project_manager">甲方项目经理</label>
                </div>
            </div>
        </form>
    </div>
    <div class="modal-footer">
        <a href="#!" class="modal-close waves-effect waves-grey btn-flat">取消</a>
        <a href="#!" class="waves-effect waves-light btn" id="submitCreateProject">确认</a>
    </div>
</div>

<!-- 项目详情模态框 -->
<div id="projectDetailModal" class="modal modal-fixed-footer" style="width: 90%; max-width: 900px;">
    <div class="modal-content">
        <h5 id="projectDetailTitle">项目详情</h5>
        <ul class="tabs">
            <li class="tab col s3"><a href="#projectBasicTab" class="active">基本信息</a></li>
            <li class="tab col s3"><a href="#projectPersonsTab">参与人员</a></li>
            <li class="tab col s3"><a href="#projectHistoryTab">历史记录</a></li>
        </ul>
        
        <div id="projectBasicTab" class="col s12" style="padding-top: 20px;">
            <form id="projectEditForm">
                <div class="row">
                    <div class="input-field col s12">
                        <input id="edit_contract_name" name="contract_name" type="text" required>
                        <label for="edit_contract_name">合同名称 *</label>
                    </div>
                    <div class="input-field col s12 m6">
                        <input id="edit_start_date" name="start_date" type="date">
                        <label for="edit_start_date">开始日期</label>
                    </div>
                    <div class="input-field col s12 m6">
                        <input id="edit_end_date" name="end_date" type="date">
                        <label for="edit_end_date">结束日期</label>
                    </div>
                    <div class="input-field col s12">
                        <input id="edit_client_company" name="client_company" type="text">
                        <label for="edit_client_company">甲方单位</label>
                    </div>
                    <div class="input-field col s12 m6">
                        <input id="edit_client_department" name="client_department" type="text">
                        <label for="edit_client_department">甲方部门</label>
                    </div>
                    <div class="input-field col s12">
                        <input id="edit_client_project_manager" name="client_project_manager" type="text">
                        <label for="edit_client_project_manager">甲方项目经理</label>
                    </div>
                </div>
            </form>
        </div>
        
        <div id="projectPersonsTab" class="col s12" style="padding-top: 20px;">
            <div class="right-align" style="margin-bottom: 16px;">
                <a class="btn waves-effect waves-light btn-small" id="openAddPersonModal">
                    <i class="material-icons left">person_add</i>添加人员
                </a>
            </div>
            <div id="projectPersonsList">
                <p class="grey-text center-align">正在加载...</p>
            </div>
        </div>
        
        <div id="projectHistoryTab" class="col s12" style="padding-top: 20px;">
            <div id="projectHistoryList">
                <p class="grey-text center-align">正在加载...</p>
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <a href="#!" class="modal-close waves-effect waves-grey btn-flat">关闭</a>
        <a href="#!" class="waves-effect waves-light btn" id="submitProjectEdit" style="display: none;">保存修改</a>
    </div>
</div>

<!-- 添加项目参与人员模态框 -->
<div id="addPersonModal" class="modal">
    <div class="modal-content">
        <h5>添加项目参与人员</h5>
        <form id="addPersonForm">
            <div class="row">
                <div class="input-field col s12">
                    <select id="personSelect" name="person_id" required>
                        <option value="" disabled selected>请选择人员</option>
                    </select>
                    <label>人员 *</label>
                </div>
                <div class="input-field col s12">
                    <input id="project_position" name="project_position" type="text">
                    <label for="project_position">入项岗位</label>
                </div>
                <div class="input-field col s12">
                    <input id="material_submit_date" name="material_submit_date" type="date">
                    <label for="material_submit_date">材料提交时间</label>
                </div>
                <div class="input-field col s12">
                    <input id="assessment_level" name="assessment_level" type="text">
                    <label for="assessment_level">评定等级</label>
                </div>
                <div class="input-field col s12">
                    <input id="unit_price" name="unit_price" type="number" step="0.01" min="0">
                    <label for="unit_price">评定单价</label>
                </div>
                <div class="input-field col s12">
                    <input id="process_status" name="process_status" type="text">
                    <label for="process_status">当前管理流程状态</label>
                </div>
            </div>
        </form>
    </div>
    <div class="modal-footer">
        <a href="#!" class="modal-close waves-effect waves-grey btn-flat">取消</a>
        <a href="#!" class="waves-effect waves-light btn" id="submitAddPerson">确认</a>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="{{ url_for('static', filename='js/projects.js') }}"></script>
{% endblock %}

