{% extends "layout.html" %}
{% block title %}个税专项附加扣除批量调整{% endblock %}

{% block extra_head %}
<style>
    .batch-card {
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(18,38,63,.08);
    }
    .tax-deduction-batch-modal {
        max-height: 85vh;
        width: 95vw;
        border-radius: 12px;
    }
    .tax-deduction-batch-modal .modal-content {
        padding: 24px 24px 8px;
        overflow-x: auto;
    }
    .tax-deduction-batch-modal .modal-footer {
        padding: 8px 24px;
    }
    #taxDeductionBatchPreviewTableContainer table thead {
        background: #f5f5f5;
    }
    #taxDeductionBatchPreviewTableContainer table thead th {
        font-size: 12px;
        color: #616161;
    }
    .tax-deduction-table {
        min-width: 1800px;
    }
    .tax-deduction-table th,
    .tax-deduction-table td {
        padding: 8px 6px;
        white-space: nowrap;
    }
</style>
{% endblock %}

{% block content %}
<div class="section">
    <h5>个税专项附加扣除批量调整</h5>
    <p class="grey-text text-darken-1">
        为符合条件的在职员工批量设置个税专项附加扣除数据，包括继续教育、三岁及以下婴幼儿、子女教育、住房贷款利息、住房租金和赡养老人。
    </p>

    <div class="card batch-card">
        <div class="card-content">
            <span class="card-title" style="font-size:18px;">调整参数</span>
            <form id="taxDeductionBatchForm">
                <div class="row">
                    <div class="input-field col s12 m4">
                        <input id="tax_deduction_effective_date" name="effective_date" type="date">
                        <label for="tax_deduction_effective_date" class="active">生效日期</label>
                    </div>
                    <div class="input-field col s12 m4">
                        <input id="tax_deduction_effective_month" name="effective_month" type="text" placeholder="例如：2025-11">
                        <label for="tax_deduction_effective_month" class="active">生效月份（YYYY-MM）</label>
                    </div>
                    <div class="input-field col s12 m4">
                        <input id="tax_deduction_target_company" name="target_company" type="text">
                        <label for="tax_deduction_target_company">仅限公司（可选）</label>
                    </div>
                </div>
                <div class="row">
                    <div class="input-field col s12 m4">
                        <input id="tax_deduction_target_department" name="target_department" type="text">
                        <label for="tax_deduction_target_department">仅限部门（可选）</label>
                    </div>
                    <div class="input-field col s12 m4">
                        <input id="tax_deduction_target_employee_type" name="target_employee_type" type="text">
                        <label for="tax_deduction_target_employee_type">仅限员工类别（可选）</label>
                    </div>
                    <div class="input-field col s12 m4">
                        <input id="tax_deduction_note" name="note" type="text">
                        <label for="tax_deduction_note">备注（可选）</label>
                    </div>
                </div>
                <div class="row">
                    <div class="col s12">
                        <h6 style="font-size: 14px; color: #666; margin-top: 20px;">默认扣除金额（可选，留空则保持当前值）</h6>
                    </div>
                </div>
                <div class="row">
                    <div class="input-field col s12 m4">
                        <input id="default_continuing_education" name="default_continuing_education" type="number" step="0.01" min="0">
                        <label for="default_continuing_education">继续教育（元/月）</label>
                    </div>
                    <div class="input-field col s12 m4">
                        <input id="default_infant_care" name="default_infant_care" type="number" step="0.01" min="0">
                        <label for="default_infant_care">三岁及以下婴幼儿（元/月）</label>
                    </div>
                    <div class="input-field col s12 m4">
                        <input id="default_children_education" name="default_children_education" type="number" step="0.01" min="0">
                        <label for="default_children_education">子女教育（元/月）</label>
                    </div>
                </div>
                <div class="row">
                    <div class="input-field col s12 m4">
                        <input id="default_housing_loan_interest" name="default_housing_loan_interest" type="number" step="0.01" min="0">
                        <label for="default_housing_loan_interest">住房贷款利息（元/月）</label>
                    </div>
                    <div class="input-field col s12 m4">
                        <input id="default_housing_rent" name="default_housing_rent" type="number" step="0.01" min="0">
                        <label for="default_housing_rent">住房租金（元/月）</label>
                    </div>
                    <div class="input-field col s12 m4">
                        <input id="default_elderly_support" name="default_elderly_support" type="number" step="0.01" min="0">
                        <label for="default_elderly_support">赡养老人（元/月）</label>
                    </div>
                </div>
            </form>
        </div>
        <div class="card-action right-align">
            <button id="previewTaxDeductionBatchBtn" class="btn waves-effect waves-light">
                <i class="material-icons left">visibility</i>预览批量调整
            </button>
        </div>
    </div>

    <div class="card batch-card" style="margin-top:24px;">
        <div class="card-content">
            <span class="card-title" style="font-size:18px;">最近批次</span>
            <div id="taxDeductionBatchHistoryContainer" class="grey-text">加载中...</div>
        </div>
    </div>
</div>

<!-- 批量预览 / 详情模态框 -->
<div id="taxDeductionBatchPreviewModal" class="modal modal-fixed-footer tax-deduction-batch-modal">
    <div class="modal-content">
        <h5 id="taxDeductionBatchPreviewTitle">个税专项附加扣除批量调整预览</h5>
        <div id="taxDeductionBatchPreviewSummary" class="grey-text" style="margin-bottom: 12px;"></div>
        <div id="taxDeductionBatchPreviewTableContainer" style="max-height: 400px; overflow-y: auto;">
            <!-- 表格渲染在这里 -->
        </div>
    </div>
    <div class="modal-footer">
        <a href="#!" class="modal-close waves-effect waves-green btn-flat">取消</a>
        <button id="confirmTaxDeductionBatchBtn" class="waves-effect waves-light btn">确认</button>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="{{ url_for('static', filename='js/tax_deduction_batch.js') }}"></script>
{% endblock %}


