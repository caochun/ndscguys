{% extends "layout.html" %}
{% block title %}考勤管理{% endblock %}
{% block extra_head %}
<style>
    .filter-card {
        padding: 16px;
    }
    .section-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 12px;
    }
</style>
{% endblock %}

{% block content %}
<div class="section">
    <div class="section-header">
        <h4 class="grey-text text-darken-2" style="margin: 0;">考勤记录</h4>
        <a class="btn waves-effect waves-light" id="openAttendanceModal">
            <i class="material-icons left">add</i>新增考勤
        </a>
    </div>

    <div class="card filter-card">
        <form id="attendanceFilterForm">
            <div class="row" style="margin-bottom: 0;">
                <div class="input-field col s12 m4">
                    <select id="attendancePersonSelect" name="person_id" required>
                        <option value="" disabled selected>请选择人员</option>
                    </select>
                    <label>人员</label>
                </div>
                <div class="input-field col s12 m3">
                    <input type="date" id="attendanceStartDate" name="start_date">
                    <label for="attendanceStartDate" class="active">开始日期</label>
                </div>
                <div class="input-field col s12 m3">
                    <input type="date" id="attendanceEndDate" name="end_date">
                    <label for="attendanceEndDate" class="active">结束日期</label>
                </div>
                <div class="input-field col s12 m2" style="margin-top: 24px;">
                    <button class="btn waves-effect waves-light" type="submit">
                        查询
                    </button>
                </div>
            </div>
        </form>
    </div>

    <div class="card">
        <div class="card-content">
            <table class="striped responsive-table">
                <thead>
                <tr>
                    <th>日期</th>
                    <th>上班时间</th>
                    <th>下班时间</th>
                    <th>工作时长</th>
                    <th>加班</th>
                    <th>状态</th>
                    <th>备注</th>
                </tr>
                </thead>
                <tbody id="attendanceTableBody">
                <tr>
                    <td colspan="7" class="center-align grey-text">请选择人员进行查询</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- 新增考勤 Modal -->
<div id="attendanceModal" class="modal modal-fixed-footer">
    <div class="modal-content">
        <h5>新增考勤</h5>
        <form id="attendanceForm">
            <div class="row">
                <div class="input-field col s12 m6">
                    <select id="attendancePersonField" name="person_id" required>
                        <option value="" disabled selected>请选择人员</option>
                    </select>
                    <label>人员</label>
                </div>
                <div class="input-field col s12 m6">
                    <input type="date" id="attendanceDate" name="date" required>
                    <label for="attendanceDate" class="active">日期</label>
                </div>
                <div class="input-field col s12 m6">
                    <input type="time" id="checkInTime" name="check_in_time">
                    <label for="checkInTime" class="active">上班时间</label>
                </div>
                <div class="input-field col s12 m6">
                    <input type="time" id="checkOutTime" name="check_out_time">
                    <label for="checkOutTime" class="active">下班时间</label>
                </div>
                <div class="input-field col s12 m6">
                    <input type="number" id="workHours" name="work_hours" step="0.1" min="0" value="8">
                    <label for="workHours">工作时长(小时)</label>
                </div>
                <div class="input-field col s12 m6">
                    <input type="number" id="overtimeHours" name="overtime_hours" step="0.1" min="0" value="0">
                    <label for="overtimeHours">加班时长(小时)</label>
                </div>
                <div class="input-field col s12">
                    <select id="attendanceStatus" name="status">
                        <option value="正常" selected>正常</option>
                        <option value="迟到">迟到</option>
                        <option value="早退">早退</option>
                        <option value="缺勤">缺勤</option>
                        <option value="外勤">外勤</option>
                    </select>
                    <label>状态</label>
                </div>
                <div class="input-field col s12">
                    <textarea id="attendanceNote" name="note" class="materialize-textarea"></textarea>
                    <label for="attendanceNote">备注</label>
                </div>
            </div>
        </form>
    </div>
    <div class="modal-footer">
        <a href="#!" class="modal-close waves-effect waves-green btn-flat">取消</a>
        <button type="submit" form="attendanceForm" class="btn waves-effect waves-light">保存</button>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="{{ url_for('static', filename='js/attendance.js') }}"></script>
{% endblock %}

